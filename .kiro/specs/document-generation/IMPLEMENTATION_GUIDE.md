# Document Generation Implementation Guide

## Overview
The chat interface at `/chat` now includes integrated document generation with a 3-panel workspace.

## Features Implemented

### 1. Chat Interface (`/chat`)
- Full-screen chat with Crowe Logic AI
- Message history
- Real-time responses
- Document generation triggers

### 2. Document Generation Buttons
Located in the top navigation:
- **Generate SOP** - Creates Standard Operating Procedures
- **Generate Report** - Creates analysis/contamination reports
- **Generate Business Plan** - Creates financial models

### 3. Three-Panel Workspace
When document generation starts:
- **Left Panel:** Markdown source code (editable)
- **Center Panel:** Chat conversation
- **Right Panel:** Live document preview

### 4. Panel Controls
- Toggle code panel on/off
- Toggle preview panel on/off
- Close workspace (return to chat-only)
- Responsive layout

## User Flow

### Generating an SOP
1. User visits `/chat`
2. Clicks "Generate SOP" button
3. Workspace opens with 3 panels
4. Chat asks for details (species, batch size, etc.)
5. Left panel shows markdown being generated
6. Right panel shows formatted document preview
7. User can edit markdown directly
8. Download PDF/Word when complete

### Example Conversation
```
User: "I need an SOP for oyster mushroom substrate prep"

Crowe Logic AI: "I'll create that for you. What's your batch size?"

User: "50 pound bags, about 100 bags per batch"

Crowe Logic AI: [Generates SOP with exact formulations]
```

## Next Steps for Full Implementation

### Phase 1: Backend API (Priority)
```typescript
// app/api/chat/route.ts
export async function POST(req: Request) {
  const { messages, documentType } = await req.json()
  
  // Call your Crowe Logic AI backend
  const response = await fetch(process.env.CROWE_LOGIC_API_URL, {
    method: 'POST',
    headers: {
      'Authorization': `Bearer ${process.env.CROWE_LOGIC_API_KEY}`,
      'Content-Type': 'application/json'
    },
    body: JSON.stringify({
      messages,
      documentType,
      stream: true
    })
  })
  
  return new Response(response.body, {
    headers: { 'Content-Type': 'text/event-stream' }
  })
}
```

### Phase 2: Document Rendering
```typescript
// app/api/documents/render/route.ts
export async function POST(req: Request) {
  const { markdown, template } = await req.json()
  
  // Convert markdown to PDF
  const pdf = await generatePDF(markdown, {
    template,
    branding: 'southwest-mushrooms',
    header: true,
    footer: true
  })
  
  return new Response(pdf, {
    headers: {
      'Content-Type': 'application/pdf',
      'Content-Disposition': 'attachment; filename="sop.pdf"'
    }
  })
}
```

### Phase 3: Real-time Streaming
```typescript
// In chat page component
const streamResponse = async (message: string) => {
  const response = await fetch('/api/chat', {
    method: 'POST',
    body: JSON.stringify({ messages, documentType })
  })
  
  const reader = response.body?.getReader()
  const decoder = new TextDecoder()
  
  while (true) {
    const { done, value } = await reader.read()
    if (done) break
    
    const chunk = decoder.decode(value)
    // Update markdown in left panel
    // Update preview in right panel
  }
}
```

### Phase 4: Document Storage
```typescript
// Save generated documents
const saveDocument = async (document: Document) => {
  await fetch('/api/documents', {
    method: 'POST',
    body: JSON.stringify({
      type: document.type,
      content: document.markdown,
      metadata: {
        userId: user.id,
        createdAt: new Date(),
        version: 1
      }
    })
  })
}
```

## Environment Variables Needed

```env
# Crowe Logic AI Backend
CROWE_LOGIC_API_URL=https://api.crowelogic.ai
CROWE_LOGIC_API_KEY=your_api_key_here

# Document Storage
DOCUMENT_STORAGE_URL=your_storage_url
DOCUMENT_STORAGE_KEY=your_storage_key

# PDF Generation (if using external service)
PDF_SERVICE_URL=your_pdf_service
PDF_SERVICE_KEY=your_pdf_key
```

## Templates

### SOP Template Structure
```markdown
# Standard Operating Procedure
## [Title]

**Document ID:** CL-SOP-[NUMBER]
**Created:** [DATE]
**Author:** Crowe Logic AI

### Purpose
[Purpose statement]

### Scope
[Scope description]

### Materials Required
- [Material 1]
- [Material 2]

### Equipment
- [Equipment 1]
- [Equipment 2]

### Procedure
1. [Step 1]
2. [Step 2]

### Quality Control
- [QC checkpoint 1]
- [QC checkpoint 2]

### Safety Considerations
- [Safety note 1]
- [Safety note 2]

---
Generated by Crowe Logic AI
© [YEAR] Southwest Mushrooms
```

### Report Template Structure
```markdown
# Contamination Analysis Report
## [Species] - [Date]

**Report ID:** CL-RPT-[NUMBER]
**Analyst:** Crowe Logic AI

### Executive Summary
[Summary]

### Visual Analysis
[Image analysis results]

### Identification
- **Contaminant:** [Type]
- **Confidence:** [Percentage]
- **Severity:** [Level]

### Root Cause Analysis
[Analysis]

### Recommended Actions
1. [Action 1]
2. [Action 2]

### Prevention Strategies
[Strategies]

---
Generated by Crowe Logic AI
© [YEAR] Southwest Mushrooms
```

## Styling & Branding

### Document Styles
All generated documents include:
- Crowe Logic AI logo
- Southwest Mushrooms branding
- Purple accent colors
- Professional typography
- Document ID for tracking
- Copyright footer

### Export Options
- **PDF:** Print-ready, branded
- **Word:** Editable .docx
- **Markdown:** Raw source
- **HTML:** Web-ready

## Mobile Considerations

### Responsive Behavior
- **Desktop (>1200px):** All 3 panels visible
- **Tablet (768-1200px):** Chat + toggle between code/preview
- **Mobile (<768px):** Chat only, panels in modals

### Mobile Optimizations
- Larger touch targets
- Simplified controls
- Swipe gestures for panels
- Bottom sheet for document options

## Testing Checklist

- [ ] Chat sends/receives messages
- [ ] Document generation triggers workspace
- [ ] Panels toggle correctly
- [ ] Markdown updates in real-time
- [ ] Preview renders correctly
- [ ] PDF export works
- [ ] Mobile responsive
- [ ] Keyboard shortcuts work
- [ ] Error handling
- [ ] Loading states

## Future Enhancements

### Version 2.0
- [ ] Collaborative editing
- [ ] Document version history
- [ ] Template library
- [ ] Custom branding options
- [ ] Multi-language support
- [ ] Voice input
- [ ] Image upload in chat
- [ ] Document comparison
- [ ] Batch generation
- [ ] API access for integrations
